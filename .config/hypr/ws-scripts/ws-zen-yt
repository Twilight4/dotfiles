#!/bin/bash

TARGET_WS=5

# Cache JSON
CLIENTS_JSON="$(hyprctl -j clients)"

# Function: check if Zen YouTube tab exists on workspace 5
zen_youtube_on_target_ws() {
  echo "$CLIENTS_JSON" | jq -e \
    --arg ws "$TARGET_WS" \
    '.[] |
      select(.title | endswith("YouTube — Zen Browser")) |
      select(.workspace.id == ($ws | tonumber))
    ' >/dev/null
}

# Function: check if ANY Zen YouTube tab exists anywhere
zen_youtube_anywhere() {
  echo "$CLIENTS_JSON" | jq -e \
    '.[] | select(.title | endswith("YouTube — Zen Browser"))' >/dev/null
}

# MAIN LOGIC
if zen_youtube_on_target_ws; then
    # YouTube tab already on workspace 5
    hyprctl dispatch workspace "$TARGET_WS"

elif zen_youtube_anywhere; then
    # YouTube tab exists but NOT on workspace 5 → open new one on 5
    hyprctl dispatch exec "[workspace $TARGET_WS] zen-browser -P Youtube"

else
    # No YouTube tab at all → launch Zen YouTube profile on 5
    hyprctl dispatch exec "[workspace $TARGET_WS] zen-browser -P Youtube"
fi

DEBUG=1
log() { [ "$DEBUG" = 1 ] && echo "$@"; }
log "Zen on WS $TARGET_WS: $(zen_on_target_ws; echo $?)"
log "Zen anywhere: $(zen_running_anywhere; echo $?)"
